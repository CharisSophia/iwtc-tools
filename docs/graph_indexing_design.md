# Graph Indexing – Design Overview

This document defines the design, scope, and responsibilities of the graph indexing tooling implemented in `iwtc-tools`. It captures the conceptual contract for transforming canonical index artifacts into graph-structured artifacts.

The corresponding execution notebook is:
- `notebooks/IWTC_Graph_Indexing.ipynb`

Readers should treat this document as the authoritative description of how index tables are translated into graph grammar. The notebook implements this design.

---

## Purpose and scope

This tooling converts canonical index artifacts into graph-structured artifacts.

It translates tabular index grammar into explicit graph grammar:

- Index tables encode relationships implicitly through columns.
- Graph artifacts encode structure explicitly as:
  - nodes (typed world objects)
  - edges (subject–predicate–object statements)
  - weight (optional)

Node construction defines stable, typed world objects derived from index identifiers.  
Edge construction expresses explicit subject–predicate–object relationships between those nodes.

The result is a reproducible graph representation that preserves the evidence-first structure of the original indexes while making structural relationships explicit.

This notebook operates strictly on existing canonical indexes and produces new graph artifacts; it does not modify source materials.

---

## Graph indexing workflow

Graph indexing is a structured transformation over existing canonical indexes.

1. A human selects a world repository and index version.
2. The notebook loads and validates canonical index artifacts.
3. The notebook constructs graph nodes from:
   - entity identifiers
   - chunk identifiers
   - source files
   - vocabulary entries
4. The notebook translates index table grammar into graph edge grammar.
5. The notebook aggregates weighted relationships where appropriate.
6. The notebook writes graph artifacts to `working_drafts` for review.

Node construction defines *what exists* in the graph.  
Edge construction defines *how those things are related*.

The workflow is typically run without modification.  
If satisfactory, the human promotes the artifacts into the repository’s canonical `indexes.path` and commits them to version control. Promotion is always a deliberate human action.

---

## Assumptions

- Canonical index artifacts exist and were generated by the raw source indexing workflow; they are reproducible and not manually edited.
- Vocabulary files are human-maintained and may evolve independently.
- Graph artifacts are derived entirely from existing index evidence.
- Weighted relationships (e.g., co-occurrence) reflect frequency within indexed chunks, not narrative importance.

Graph indexing performs structural translation only.  
It does not interpret meaning, resolve ambiguity, or infer chronology beyond what the indexes explicitly encode.

## Inputs

Graph indexing operates on canonical index artifacts and vocabulary tables declared in the world repository descriptor. All inputs must correspond to a single explicit index version.

### Required

- Canonical index tables describing:
  - chunk-to-entity mappings
  - source file metadata
- Vocabulary lookup tables mapping normalized text forms to entity or player IDs

### Optional

- Additional vocabulary tables (aliases, author mappings, player/character mappings)

All inputs are read-only. Graph indexing does not modify canonical index artifacts.

---

## Outputs

Graph indexing produces two machine-generated CSV artifacts:

- `graph_nodes_vN.csv`
- `graph_edges_vN.csv`

Nodes represent structural elements of the indexed world, including:

- Chunks
- Source files
- Vocabulary entries
- Canonical entities and players

Edges represent translated index grammar in subject–predicate–object form, with an optional `weight` column for aggregated relationships.

Graph artifacts are reproducible from the same index version and descriptor configuration.  
They are written to `working_drafts` for review before optional promotion to canonical storage.

Graph indexing produces a derived structural layer only.
